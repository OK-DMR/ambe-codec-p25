#include "mmdvm.h"
#include <oboe/Oboe.h>

extern "C"
JNIEXPORT jint JNI_OnLoad(JavaVM *vm, void *reserved) {
    return JNI_VERSION_1_6;
}

extern "C"
JNIEXPORT void JNICALL
Java_cz_okdmr_mmdvm_MainActivity_getNativeString(JNIEnv *env, jobject thiz) {
    if (!globalPlayer) {
        globalPlayer = new OboePlayer();
    }

    unsigned char voicedata[][9] = {
            {136, 248, 194, 22,  75,  170, 212, 198, 103},
            {215, 110, 198, 177, 26,  146, 152, 43,  107},
            {200, 25,  131, 54,  100, 80,  217, 227, 0},
            {219, 170, 197, 118, 100, 63,  208, 107, 212},
            {217, 136, 199, 116, 100, 47,  208, 47,  213},
            {219, 138, 196, 116, 36,  93,  245, 11,  0},
            {217, 169, 196, 86,  70,  47,  209, 43,  227},
            {217, 137, 198, 116, 100, 47,  209, 47,  231},
            {217, 136, 198, 116, 100, 47,  209, 47,  0},
            {155, 201, 163, 112, 66,  87,  20,  43,  107},
            {155, 201, 163, 112, 66,  87,  21,  43,  73},
            {169, 235, 131, 82,  98,  103, 20,  111, 0},
            {155, 202, 161, 112, 64,  67,  16,  110, 111},
            {155, 202, 161, 112, 64,  67,  16,  111, 93},
            {169, 234, 131, 82,  98,  103, 20,  127, 0},
            {218, 170, 196, 118, 100, 63,  241, 91,  213},
            {189, 195, 224, 179, 119, 123, 244, 64,  200},
            {96,  82,  138, 20,  99,  26,  9,   228, 0},
            {219, 170, 228, 52,  4,   107, 240, 57,  198},
            {217, 136, 196, 22,  2,   105, 211, 27,  230},
            {217, 139, 198, 52,  38,  105, 131, 25,  0},
            {217, 137, 196, 22,  2,   107, 211, 41,  215},
            {250, 11,  163, 99,  39,  81,  136, 151, 18},
            {142, 93,  226, 5,   32,  246, 44,  186, 0},
            {61,  177, 164, 225, 86,  157, 232, 108, 128},
            {253, 231, 162, 82,  84,  17,  89,  231, 216},
            {205, 172, 226, 80,  100, 130, 229, 5,   0},
            {205, 172, 226, 80,  100, 146, 196, 53,  28},
            {205, 172, 227, 80,  100, 131, 196, 53,  12},
            {14,  66,  94,  137, 194, 152, 1,   244, 0},
            {88,  85,  62,  181, 89,  187, 77,  129, 113},
            {12,  176, 46,  76,  95,  125, 29,  41,  253},
            {94,  190, 76,  166, 206, 153, 20,  223, 0},
            {91,  171, 26,  227, 209, 168, 229, 77,  148},
            {125, 200, 24,  82,  183, 101, 216, 178, 229},
            {42,  188, 99,  60,  227, 33,  33,  84,  0},
            {88,  173, 52,  118, 44,  205, 41,  95,  164},
            {90,  138, 38,  114, 166, 5,   37,  142, 49},
            {27,  189, 98,  24,  230, 53,  37,  3,   0},
            {42,  142, 97,  28,  246, 100, 33,  67,  57},
            {89,  141, 5,   48,  30,  189, 105, 15,  181},
            {25,  158, 66,  30,  210, 17,  33,  17,  0},
            {40,  156, 65,  58,  212, 1,   33,  0,   57},
            {74,  136, 22,  118, 151, 80,  33,  154, 35},
            {88,  168, 4,   82,  148, 85,  3,   202, 0},
            {25,  219, 64,  118, 148, 45,  229, 139, 172},
            {26,  248, 66,  116, 148, 61,  196, 252, 191},
            {88,  185, 5,   82,  148, 69,  33,  217, 0},
            {72,  172, 37,  118, 61,  205, 40,  93,  151},
            {57,  158, 97,  62,  243, 49,  33,  17,  43},
            {56,  159, 96,  62,  243, 33,  49,  1,   0},
            {27,  174, 66,  28,  209, 21,  7,   17,  27},
            {57,  172, 67,  124, 213, 81,  116, 85,  74},
            {26,  171, 96,  123, 46,  201, 41,  227, 0},
            {121, 172, 22,  113, 74,  175, 30,  27,  226},
            {10,  237, 97,  49,  74,  194, 139, 59,  123},
            {63,  235, 68,  117, 108, 89,  253, 113, 0},
            {110, 184, 96,  119, 87,  190, 237, 218, 114},
            {78,  206, 102, 215, 65,  168, 195, 27,  238},
            {127, 239, 70,  241, 17,  136, 131, 75,  0},
            {12,  217, 42,  213, 116, 24,  137, 127, 24},
            {176, 18,  11,  232, 228, 113, 160, 11,  179},
            {152, 198, 230, 196, 50,  144, 160, 11,  0},
            {240, 23,  172, 53,  164, 153, 206, 243, 83},
            {249, 227, 166, 70,  81,  200, 89,  200, 4},
            {186, 145, 128, 51,  24,  73,  108, 99,  0},
            {200, 243, 196, 53,  121, 39,  152, 51,  95},
            {252, 30,  134, 71,  66,  249, 136, 189, 190},
            {169, 104, 230, 5,   65,  89,  29,  244, 0},
            {234, 9,   128, 35,  65,  65,  217, 147, 80},
            {222, 215, 161, 102, 118, 64,  93,  198, 252},
            {157, 205, 164, 112, 0,   234, 20,  99,  0},
            {173, 237, 132, 114, 5,   174, 0,   98,  149},
            {147, 8,   132, 144, 73,  83,  122, 16,  30},
            {254, 62,  212, 32,  110, 21,  56,  39,  0},
            {216, 114, 163, 19,  14,  125, 197, 141, 154},
            {147, 79,  194, 87,  50,  222, 247, 95,  220},
            {148, 90,  164, 86,  45,  171, 81,  138, 0},
            {144, 220, 28,  205, 105, 68,  91,  193, 21},
            {165, 72,  47,  238, 68,  73,  129, 191, 54},
            {14,  234, 27,  144, 69,  9,   136, 15,  0},
            {91,  237, 54,  60,  208, 109, 227, 35,  166},
            {123, 168, 7,   87,  161, 69,  48,  171, 49},
            {10,  142, 66,  25,  228, 97,  7,   67,  0},
            {120, 217, 37,  95,  126, 145, 223, 151, 97},
            {10,  158, 66,  25,  229, 97,  20,  98,  56},
            {56,  184, 66,  61,  94,  253, 75,  213, 0},
            {148, 22,  34,  106, 229, 5,   65,  212, 249},
            {148, 52,  0,   8,   128, 5,   83,  131, 233},
            {132, 34,  3,   108, 90,  168, 105, 1,   0},
            {166, 34,  3,   10,  121, 201, 12,  35,  125},
            {182, 49,  35,  14,  94,  249, 45,  16,  92},
            {150, 16,  1,   110, 91,  169, 90,  85,  0},
            {164, 18,  33,  12,  79,  249, 45,  70,  127},
            {180, 52,  0,   44,  133, 17,  87,  199, 249},
            {74,  138, 7,   21,  149, 80,  101, 137, 0},
            {42,  173, 98,  61,  227, 49,  3,   71,  59},
            {106, 142, 53,  51,  46,  184, 75,  29,  135},
            {88,  190, 4,   83,  41,  185, 27,  43,  0},
            {122, 188, 7,   87,  79,  138, 27,  46,  151},
            {88,  141, 4,   119, 109, 171, 11,  107, 247},
            {72,  248, 39,  61,  125, 161, 171, 147, 0},
            {243, 70,  96,  40,  77,  42,  219, 122, 47},
            {146, 7,   36,  44,  30,  37,  125, 41,  199},
            {231, 80,  35,  167, 53,  86,  209, 209, 0},
            {145, 97,  104, 176, 66,  9,   154, 234, 217},
            {181, 75,  46,  234, 97,  75,  212, 255, 49},
            {135, 75,  47,  207, 32,  93,  198, 252, 0},
            {186, 160, 229, 154, 18,  142, 64,  131, 163},
            {242, 112, 139, 214, 177, 184, 245, 34,  155},
            {56,  236, 63,  211, 7,   149, 189, 81,  0},
            {128, 32,  13,  66,  177, 27,  30,  103, 235},
            {210, 1,   55,  137, 50,  209, 1,   52,  203},
            {198, 36,  15,  126, 54,  194, 209, 173, 0},
            {244, 23,  42,  240, 21,  216, 73,  231, 248},
            {164, 100, 111, 229, 86,  165, 201, 247, 116},
            {148, 116, 61,  163, 110, 26,  14,  46,  0},
            {178, 21,  2,   195, 46,  61,  165, 2,   142},
            {177, 5,   33,  129, 60,  28,  229, 87,  237},
            {192, 85,  69,  135, 28,  38,  21,  33,  0},
            {224, 85,  103, 133, 29,  100, 117, 80,  7},
            {145, 38,  3,   199, 61,  61,  165, 18,  253},
            {134, 3,   6,   227, 26,  225, 225, 13,  0},
            {179, 6,   3,   225, 59,  60,  165, 69,  234},
            {179, 5,   2,   214, 46,  77,  161, 70,  234},
            {178, 6,   1,   146, 75,  28,  128, 117, 0},
            {128, 52,  34,  240, 44,  25,  211, 86,  218},
            {242, 116, 100, 150, 78,  86,  71,  114, 118},
            {240, 116, 68,  210, 120, 87,  7,   39,  0},
            {144, 7,   69,  30,  18,  203, 158, 166, 235},
            {224, 68,  4,   241, 64,  141, 176, 251, 47},
            {212, 111, 73,  160, 6,   93,  129, 39,  0},
            {226, 197, 75,  237, 96,  112, 192, 168, 112},
            {150, 248, 75,  154, 80,  39,  153, 34,  229},
            {214, 154, 245, 114, 22,  98,  92,  138, 0},
            {170, 212, 167, 211, 95,  61,  50,  225, 77},
            {58,  142, 251, 146, 250, 164, 195, 18,  51},
            {178, 76,  194, 67,  80,  201, 245, 45,  0},
            {110, 150, 108, 232, 11,  84,  198, 248, 206},
            {108, 179, 121, 98,  229, 193, 112, 87,  68},
            {24,  30,  30,  87,  229, 217, 103, 99,  0},
            {78,  73,  94,  103, 150, 77,  229, 62,  71},
            {42,  102, 125, 83,  225, 123, 236, 245, 163},
            {122, 20,  27,  33,  181, 53,  93,  230, 0},
            {72,  34,  37,  196, 62,  17,  128, 132, 47},
            {0,   157, 34,  151, 84,  234, 201, 251, 219},
            {210, 15,  165, 34,  49,  244, 21,  57,  0},
            {242, 62,  133, 0,   113, 164, 82,  14,  17},
            {154, 104, 230, 19,  70,  109, 29,  230, 191},
            {226, 197, 162, 7,   118, 44,  198, 83,  0},
            {251, 187, 231, 116, 100, 111, 145, 26,  245},
            {235, 170, 231, 116, 100, 111, 145, 8,   231},
            {235, 170, 231, 116, 100, 111, 145, 8,   0},
            {40,  146, 141, 97,  200, 115, 71,  71,  47},
            {76,  136, 210, 131, 74,  233, 83,  55,  130},
            {140, 110, 226, 20,  3,   211, 13,  141, 0},
            {190, 94,  42,  207, 66,  223, 13,  23,  71},
            {143, 111, 195, 36,  96,  211, 91,  202, 80},
            {142, 78,  224, 7,   32,  199, 88,  251, 0},
            {230, 225, 166, 68,  18,  149, 213, 47,  203},
            {44,  173, 195, 119, 5,   9,   72,  28,  218},
            {44,  190, 227, 115, 35,  56,  89,  28,  0},
            {243, 214, 161, 83,  3,   109, 214, 99,  103},
            {150, 216, 131, 66,  81,  104, 153, 232, 135},
            {228, 152, 28,  138, 53,  61,  89,  32,  0},
            {213, 137, 14,  137, 55,  77,  92,  0,   72},
            {154, 90,  196, 64,  22,  77,  25,  210, 207},
            {172, 181, 198, 113, 81,  61,  138, 196, 0},
            {219, 26,  131, 83,  81,  49,  153, 131, 65},
            {174, 21,  163, 22,  50,  3,   209, 79,  183},
            {159, 4,   91,  141, 66,  74,  214, 165, 0},
            {159, 23,  72,  191, 17,  24,  229, 199, 133},
            {173, 5,   161, 54,  4,   97,  193, 93,  182},
            {252, 119, 196, 116, 35,  43,  68,  30,  0},
            {213, 186, 231, 17,  112, 4,   9,   152, 9},
            {140, 22,  131, 87,  6,   32,  213, 62,  145},
            {217, 40,  131, 80,  0,   23,  142, 214, 0},
            {189, 207, 134, 112, 33,  154, 112, 20,  129},
            {185, 75,  230, 96,  117, 9,   25,  131, 205},
            {234, 24,  131, 70,  85,  103, 216, 147, 0},
            {182, 249, 160, 20,  101, 41,  137, 138, 244},
            {228, 153, 60,  169, 96,  46,  47,  64,  93},
            {186, 120, 47,  254, 99,  65,  9,   24,  0},
            {155, 101, 155, 205, 101, 74,  246, 42,  58},
            {127, 133, 253, 56,  53,  97,  13,  17,  77},
            {200, 8,   88,  139, 38,  108, 201, 25,  0},
            {253, 116, 13,  184, 38,  50,  113, 147, 12},
            {215, 169, 199, 49,  65,  36,  77,  138, 24},
            {213, 152, 197, 19,  64,  101, 9,   153, 0},
            {130, 149, 197, 81,  22,  0,   69,  83,  191},
            {247, 27,  130, 19,  1,   11,  85,  83,  156},
            {228, 168, 229, 103, 20,  112, 77,  137, 0},
            {220, 228, 163, 53,  96,  64,  9,   246, 141},
            {207, 172, 193, 50,  69,  245, 181, 52,  13},
            {207, 173, 193, 50,  69,  247, 149, 52,  0},
            {207, 188, 192, 50,  69,  247, 148, 36,  45},
            {207, 172, 192, 50,  69,  247, 181, 4,   45},
            {206, 173, 226, 114, 7,   149, 165, 36,  0},
            {233, 136, 199, 54,  70,  56,  215, 40,  229},
            {235, 171, 197, 118, 66,  12,  211, 12,  225},
            {235, 171, 196, 118, 66,  12,  210, 28,  0},
            {235, 169, 196, 80,  70,  108, 215, 12,  225},
            {203, 169, 230, 112, 103, 77,  199, 12,  229},
            {235, 169, 196, 80,  70,  108, 198, 12,  0},
            {233, 169, 230, 84,  38,  72,  199, 44,  225},
            {233, 169, 230, 84,  38,  72,  198, 12,  225},
            {235, 169, 196, 80,  70,  108, 199, 44,  0},
            {235, 171, 197, 118, 66,  14,  240, 44,  241},
            {229, 153, 229, 117, 68,  1,   105, 234, 41},
            {200, 27,  161, 86,  87,  70,  216, 227, 0},
            {252, 199, 161, 23,  87,  103, 76,  148, 220},
            {244, 184, 199, 101, 82,  37,  73,  201, 28},
            {245, 153, 231, 67,  84,  1,   77,  154, 0},
            {204, 172, 193, 16,  70,  213, 179, 113, 28},
            {206, 142, 192, 112, 70,  210, 227, 81,  28},
            {206, 142, 192, 112, 70,  209, 226, 81,  0},
            {234, 184, 229, 86,  70,  9,   230, 29,  197},
            {234, 168, 229, 86,  71,  9,   230, 29,  213},
            {234, 168, 229, 86,  71,  9,   231, 60,  0},
            {234, 168, 229, 86,  71,  9,   231, 60,  197},
            {234, 168, 229, 86,  71,  9,   231, 28,  197},
            {202, 168, 199, 118, 102, 56,  231, 60,  0},
            {234, 184, 229, 86,  71,  11,  230, 29,  197},
            {234, 184, 229, 86,  71,  11,  231, 29,  213},
            {234, 184, 229, 86,  71,  9,   230, 29,  0},
            {234, 184, 229, 86,  70,  27,  231, 29,  197},
            {234, 184, 229, 86,  71,  9,   231, 61,  197},
            {202, 184, 199, 118, 102, 57,  231, 61,  0},
            {202, 184, 199, 118, 102, 57,  231, 61,  193},
            {234, 184, 229, 86,  70,  9,   231, 61,  197},
            {234, 184, 229, 86,  70,  25,  231, 61,  0},
            {234, 168, 229, 86,  70,  25,  231, 60,  197},
            {234, 168, 229, 86,  70,  25,  231, 60,  197},
            {202, 168, 199, 118, 102, 59,  231, 28,  0},
            {202, 168, 199, 118, 102, 59,  231, 29,  193},
            {202, 168, 199, 118, 102, 59,  231, 29,  193},
            {232, 138, 229, 54,  71,  15,  183, 28,  0},
            {234, 184, 229, 86,  71,  9,   228, 29,  197},
            {234, 184, 229, 86,  70,  25,  231, 61,  197},
            {234, 168, 229, 86,  70,  25,  231, 61,  0},
            {234, 184, 229, 86,  70,  25,  231, 29,  197},
            {234, 184, 229, 86,  71,  9,   231, 61,  213},
            {206, 174, 194, 82,  100, 209, 227, 116, 0},
            {170, 44,  192, 167, 16,  29,  102, 37,  16},
            {11,  27,  141, 161, 99,  84,  213, 127, 38},
            {218, 152, 197, 84,  68,  58,  212, 8,   0},
            {218, 152, 196, 84,  68,  59,  212, 8,   230},
            {218, 152, 196, 84,  68,  59,  212, 8,   230},
            {219, 152, 196, 84,  68,  59,  212, 10,  0},
            {218, 152, 196, 84,  68,  41,  212, 10,  230},
            {250, 152, 230, 116, 100, 8,   212, 8,   226},
            {250, 152, 230, 116, 100, 8,   212, 8,   0},
            {218, 152, 196, 84,  68,  41,  212, 8,   231},
            {218, 152, 196, 84,  68,  57,  212, 8,   231},
            {250, 152, 230, 116, 100, 8,   212, 8,   0},
            {250, 152, 247, 116, 100, 10,  212, 8,   226},
            {248, 154, 231, 84,  70,  27,  196, 72,  228},
            {218, 186, 197, 118, 101, 61,  193, 104, 0},
            {250, 152, 230, 116, 100, 8,   212, 8,   227},
            {250, 152, 230, 116, 100, 10,  213, 8,   226},
            {250, 152, 230, 116, 100, 10,  213, 8,   0},
            {250, 152, 230, 116, 100, 10,  213, 8,   227},
            {250, 152, 231, 116, 100, 10,  213, 10,  227},
            {250, 152, 230, 116, 100, 8,   212, 10,  0},
            {218, 152, 197, 84,  68,  57,  212, 8,   230},
            {202, 152, 196, 84,  68,  57,  212, 10,  231},
            {234, 170, 198, 86,  70,  61,  149, 41,  0},
            {202, 136, 196, 84,  68,  57,  213, 41,  231},
            {248, 154, 230, 84,  70,  25,  212, 74,  230},
            {232, 154, 230, 84,  71,  25,  212, 72,  0},
            {202, 152, 196, 84,  68,  56,  212, 8,   230},
            {202, 152, 196, 84,  68,  56,  212, 8,   230},
            {200, 184, 228, 86,  68,  31,  149, 72,  0},
            {218, 186, 228, 118, 102, 12,  148, 8,   226},
            {216, 184, 228, 86,  68,  29,  148, 72,  230},
            {218, 186, 228, 118, 102, 12,  148, 8,   0},
            {250, 152, 230, 116, 100, 8,   212, 8,   227},
            {250, 152, 230, 116, 100, 8,   212, 8,   227},
            {250, 152, 230, 116, 100, 10,  212, 8,   0},
            {250, 152, 230, 116, 100, 8,   213, 40,  226},
            {248, 154, 246, 84,  71,  25,  213, 104, 197},
            {248, 154, 230, 84,  70,  27,  212, 88,  0},
            {248, 154, 230, 84,  70,  27,  212, 74,  231},
            {250, 152, 230, 116, 100, 10,  213, 8,   226},
            {248, 154, 230, 84,  70,  27,  213, 72,  0},
            {248, 154, 230, 84,  70,  9,   196, 72,  230},
            {248, 154, 230, 84,  70,  9,   196, 72,  231},
            {250, 152, 230, 116, 100, 8,   212, 8,   0},
            {248, 154, 230, 84,  71,  25,  212, 72,  231},
            {250, 152, 230, 116, 100, 8,   212, 8,   227},
            {250, 152, 230, 116, 100, 8,   212, 8,   0},
            {248, 154, 230, 84,  70,  25,  212, 74,  230},
            {250, 152, 230, 116, 100, 10,  213, 8,   226},
            {234, 152, 230, 116, 100, 8,   212, 8,   0},
            {234, 152, 230, 116, 100, 8,   212, 8,   226},
            {202, 152, 196, 84,  68,  57,  212, 8,   230},
            {202, 152, 197, 84,  68,  57,  212, 8,   0},
            {185, 232, 129, 82,  97,  115, 0,   42,  107},
            {185, 232, 129, 82,  97,  115, 0,   42,  107},
            {185, 232, 129, 82,  97,  115, 0,   42,  0},
            {185, 232, 129, 82,  97,  115, 0,   42,  107},
            {185, 232, 129, 82,  97,  115, 0,   42,  107},
            {185, 232, 129, 82,  97,  115, 0,   42,  0},
            {185, 232, 129, 82,  97,  115, 0,   42,  107},
            {185, 232, 129, 82,  97,  115, 0,   42,  107},
            {185, 232, 129, 82,  97,  115, 0,   42,  0},
    };

    for (auto &i: voicedata) {
        globalPlayer->addAmbeSamples(i);
    }

    auto prepareAudioResult = globalPlayer->prepareAudio();
    __android_log_print(ANDROID_LOG_WARN, "mmdvm.cpp", "prepareAudio %d", prepareAudioResult);
    auto startAudioResult = globalPlayer->startAudio();
    __android_log_print(ANDROID_LOG_WARN, "mmdvm.cpp", "startAudio %d", startAudioResult);
}

unsigned char *as_unsigned_char_array(JNIEnv *env, jbyteArray array) {
    int len = env->GetArrayLength(array);
    auto *buf = new unsigned char[len];
    env->GetByteArrayRegion(array, 0, len, reinterpret_cast<jbyte *>(buf));
    return buf;
}

extern "C"
JNIEXPORT void JNICALL
Java_cz_okdmr_mmdvm_homebrew_MMDVMClient_addSamples(JNIEnv *env, jobject thiz, jbyteArray samples) {
    if (!globalPlayer) {
        globalPlayer = new OboePlayer();
    }
    globalPlayer->addAmbeSamples(as_unsigned_char_array(env, samples));
}